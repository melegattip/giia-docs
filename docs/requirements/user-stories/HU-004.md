# HU-004: Gestionar Órdenes de Compra

---

## Metadata

| Campo | Valor |
|-------|-------|
| **ID** | HU-004 |
| **Prioridad** | Must |
| **RF Relacionados** | RF-017, RF-018, RF-019, RF-020, RF-021, RF-022, RF-023 |
| **Módulo/Componente** | Transacciones - Órdenes de Compra |
| **Estado** | Draft |

---

## Historia de Usuario

**Como** Usuario del sistema,  
**Quiero** crear, modificar y dar seguimiento a las órdenes de compra a proveedores,  
**Para** gestionar el flujo de reposición de inventario y conocer las fechas de llegada estimadas.

---

## Criterios de Aceptación

### CA-001: Crear orden de compra

- **Dado** que necesito reponer productos de un proveedor
- **Cuando** creo una OC seleccionando proveedor, productos, cantidades y fecha de emisión
- **Entonces** el sistema crea la OC en estado "Pendiente" y calcula la fecha de llegada estimada

### CA-002: Cálculo automático de fecha de llegada

- **Dado** que creo una OC con fecha de emisión 01/01/2026 para un proveedor con LT de 10 días
- **Cuando** guardo la orden
- **Entonces** la fecha estimada de llegada se calcula como 11/01/2026

### CA-003: Editar OC pendiente

- **Dado** que existe una OC en estado "Pendiente"
- **Cuando** agrego un producto adicional o modifico cantidades
- **Entonces** el sistema guarda los cambios manteniendo el estado "Pendiente"

### CA-004: Registrar recepción completa

- **Dado** que existe una OC pendiente con 100 unidades de un producto
- **Cuando** registro la recepción de las 100 unidades
- **Entonces** el sistema cambia el estado a "Recibida", registra la fecha real de llegada, y genera el ingreso automático a inventario

### CA-005: Registrar recepción parcial

- **Dado** que existe una OC con 100 unidades de un producto
- **Cuando** registro la recepción de 80 unidades
- **Entonces** el sistema mantiene el estado "Parcialmente Recibida" y permite registrar el resto posteriormente

### CA-006: Cancelar orden de compra

- **Dado** que existe una OC en estado "Pendiente"
- **Cuando** la cancelo indicando el motivo
- **Entonces** el sistema cambia el estado a "Cancelada" y libera las cantidades del inventario en tránsito

### CA-007: Listar y filtrar OC

- **Dado** que existen múltiples órdenes de compra
- **Cuando** aplico filtros por estado, proveedor o rango de fechas
- **Entonces** el sistema muestra solo las OC que cumplen los criterios

### CA-008: Ver detalle de OC

- **Dado** que existe una OC registrada
- **Cuando** accedo a su vista detallada
- **Entonces** veo: datos generales, líneas de productos con cantidades ordenadas/recibidas, estado, y trazabilidad de cambios

---

## Escenarios Alternativos

### Escenario: OC con cantidad menor a MOQ

- **Dado** que un producto tiene MOQ de 50 unidades
- **Cuando** intento crear una OC con 30 unidades
- **Entonces** el sistema muestra una advertencia indicando el MOQ y sugiere ajustar la cantidad

### Escenario: Recepción fuera de fecha

- **Dado** que la fecha de llegada estimada era 01/01/2026
- **Cuando** registro la recepción el 05/01/2026
- **Entonces** el sistema registra el desvío de 4 días para análisis de variabilidad

---

## Notas y Aclaraciones

- El inventario en tránsito se actualiza automáticamente al crear/modificar/cancelar OC
- La fecha estimada de llegada usa el Lead Time del proveedor seleccionado
- Las OC pueden contener productos de múltiples categorías pero de un solo proveedor
- El sistema mantiene historial completo de cambios en cada OC

---

## Checklist de Validación

- [x] La historia sigue el formato "Como... Quiero... Para..."
- [x] El valor/beneficio está claramente expresado
- [x] Hay al menos 1 criterio de aceptación
- [x] Los criterios siguen el formato Given/When/Then
- [x] Los RF relacionados están correctamente referenciados
- [x] La prioridad MoSCoW está asignada

---

## Señal de Completación

> Historia de usuario HU-004 completada.
