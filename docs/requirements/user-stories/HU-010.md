# HU-010: Calcular Flujo Neto

---

## Metadata

| Campo | Valor |
|-------|-------|
| **ID** | HU-010 |
| **Prioridad** | Must |
| **RF Relacionados** | RF-046, RF-047, RF-048, RF-049, RF-050, RF-051, RF-052 |
| **Módulo/Componente** | Motor DDMRP - Ecuación de Flujo Neto |
| **Estado** | Reviewed |

---

## Historia de Usuario

**Como** Usuario del sistema,  
**Quiero** que el sistema calcule automáticamente el flujo neto de cada producto considerando inventario físico, en tránsito y demanda calificada,  
**Para** conocer la posición real de mi inventario y tomar decisiones de reposición informadas.

---

## Criterios de Aceptación

### CA-001: Cálculo de inventario físico

- **Dado** que un producto tiene historial de compras/ventas/ajustes
- **Cuando** consulto su inventario
- **Entonces** el sistema muestra el inventario físico = suma de ingresos - suma de egresos

### CA-002: Cálculo de inventario en tránsito

- **Dado** que existen OC pendientes con el producto X
- **Cuando** consulto su inventario en tránsito
- **Entonces** el sistema muestra la suma de cantidades de todas las OC pendientes

### CA-003: Cálculo de demanda calificada

- **Dado** que existen OV en firme (no efectuadas) por N unidades del producto X
- **Cuando** consulto su demanda calificada
- **Entonces** el sistema muestra N unidades más cualquier pico calificado detectado

### CA-004: Umbral de pico configurable

- **Dado** que la zona roja del producto X es 100 unidades y el umbral de pico es 50% (valor default)
- **Cuando** se registra una OV por 60 unidades (>50 = 50% de 100)
- **Entonces** las 60 unidades se marcan como pico calificado y se suman a la demanda calificada

### CA-005: Ecuación de flujo neto

- **Dado** que el producto X tiene: Físico=100, En Tránsito=50, Demanda Calificada=30
- **Cuando** el sistema calcula el flujo neto
- **Entonces** Flujo Neto = 100 + 50 - 30 = 120 unidades

### CA-006: Determinar estado de buffer

- **Dado** que el flujo neto es 40 y las zonas son Roja=60, Amarilla=80, Verde=100
- **Cuando** el sistema evalúa el estado
- **Entonces** el producto está en "Zona Roja" porque 40 < 60 (tope de roja)

### CA-007: Actualización en tiempo real

- **Dado** que el producto X tiene flujo neto calculado
- **Cuando** registro una nueva OV en firme
- **Entonces** el flujo neto se actualiza inmediatamente restando las unidades de la OV y recalculando las zonas del dia de hoy.

---

## Escenarios Alternativos

### Escenario: Flujo neto negativo

- **Dado** que el producto X tiene: Físico=20, En Tránsito=0, Demanda Calificada=50
- **Cuando** el sistema calcula el flujo neto
- **Entonces** Flujo Neto = -30 (negativo) indicando Alerta de Deficit Severo

### Escenario: Modificar umbral de pico

- **Dado** que el umbral de pico está en 50% de zona roja
- **Cuando** lo modifico a 75%
- **Entonces** el sistema recalcula qué OV califican como picos y actualiza el flujo neto y las zonas del dia de hoy.

---

## Notas y Aclaraciones

- El flujo neto es la métrica central de DDMRP para evaluar la posición del inventario
- Un flujo neto en zona roja requiere acción inmediata
- Los picos calificados permiten detectar demanda extraordinaria que no debe promediar en CPD
- El umbral de pico por defecto es 50% de la zona roja, editable por usuario

---
