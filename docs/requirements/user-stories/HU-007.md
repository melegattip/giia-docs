# HU-007: Configurar Cálculo de CPD

---

## Metadata

| Campo | Valor |
|-------|-------|
| **ID** | HU-007 |
| **Prioridad** | Must |
| **RF Relacionados** | RF-031, RF-032, RF-033, RF-034 |
| **Módulo/Componente** | Motor DDMRP - CPD |
| **Estado** | Draft |

---

## Historia de Usuario

**Como** Administrador del sistema,  
**Quiero** configurar cómo se calcula el Consumo Promedio Diario (CPD) de los productos,  
**Para** que las zonas de buffer reflejen el comportamiento real de la demanda.

---

## Criterios de Aceptación

### CA-001: CPD calculado automáticamente

- **Dado** que un producto tiene historial de ventas de los últimos 30 días
- **Cuando** el sistema calcula el CPD con ventana de 7 días
- **Entonces** el CPD = (suma de ventas de últimos 7 días) / 7

### CA-002: Configurar ventana de tiempo

- **Dado** que accedo a configuración de sistema
- **Cuando** modifico la ventana de cálculo de CPD a 14 días
- **Entonces** el sistema recalcula todos los CPD usando 14 días de histórico

### CA-003: Ventana por defecto

- **Dado** que instalo el sistema por primera vez
- **Cuando** verifico la configuración de CPD
- **Entonces** la ventana de tiempo está configurada en 7 días por defecto

### CA-004: Ver CPD en detalle de producto

- **Dado** que existe un producto con transacciones
- **Cuando** accedo a su vista detallada
- **Entonces** veo el valor actual del CPD calculado y la fecha de última actualización

### CA-005: Recálculo automático al registrar venta

- **Dado** que el producto X tiene un CPD de 10 unidades/día
- **Cuando** registro una venta de 50 unidades
- **Entonces** el sistema recalcula automáticamente el CPD considerando la nueva transacción

---

## Escenarios Alternativos

### Escenario: Producto sin suficiente historial

- **Dado** que un producto tiene solo 3 días de historial
- **Cuando** el sistema calcula el CPD con ventana de 7 días
- **Entonces** usa solo los 3 días disponibles y muestra indicador de "CPD parcial"

### Escenario: CPD manual para producto nuevo

- **Dado** que creo un producto sin historial
- **Cuando** ingreso un CPD estimado manualmente
- **Entonces** el sistema usa ese valor hasta que haya historial suficiente

---

## Notas y Aclaraciones

- El CPD es la base de todos los cálculos de zonas en DDMRP
- La ventana de tiempo es global pero puede sobrescribirse por producto en futuras versiones
- El CPD excluye órdenes de venta en firme no efectuadas (no son consumo real)
- Los picos de demanda extraordinaria pueden distorsionar el CPD; los ajustes FAD compensan esto

---

## Checklist de Validación

- [x] La historia sigue el formato "Como... Quiero... Para..."
- [x] El valor/beneficio está claramente expresado
- [x] Hay al menos 1 criterio de aceptación
- [x] Los criterios siguen el formato Given/When/Then
- [x] Los RF relacionados están correctamente referenciados
- [x] La prioridad MoSCoW está asignada

---

## Señal de Completación

> Historia de usuario HU-007 completada.
